import{_ as d,c as r,o as e,ag as a}from"./chunks/framework.CCM1LoTM.js";const l=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"176. 聊天室：技术选型和数据库设计.md","filePath":"176. 聊天室：技术选型和数据库设计.md"}'),h={name:"176. 聊天室：技术选型和数据库设计.md"};function i(o,t,p,s,n,b){return e(),r("div",null,t[0]||(t[0]=[a('<p>上节梳理了需求，画了原型图，这节来设计下技术方案。</p><h2 id="技术栈" tabindex="-1">技术栈 <a class="header-anchor" href="#技术栈" aria-label="Permalink to &quot;技术栈&quot;">​</a></h2><p>前端部分还是 React + Antd Design，脚手架用 create-vite：</p><p><img src="//liushuaiyang.oss-cn-shanghai.aliyuncs.com/nest-docs/image/176-1.png" alt="" loading="lazy"></p><p>后端部分是 Nest + Prisma + Socket.io。</p><p>Prisma 是 ORM 框架，Socket.io 用来做 WebSocket 通信。</p><p>数据库是 mysql + redis，mysql 做持久化存储，redis 做缓存以及临时数据的存储。</p><p>用 minio 做 OSS 对象存储服务，存储上传的文件。</p><p>文档用 swagger 生成，部署用 docker compose + pm2。</p><h2 id="数据库设计" tabindex="-1">数据库设计 <a class="header-anchor" href="#数据库设计" aria-label="Permalink to &quot;数据库设计&quot;">​</a></h2><p>然后来设计下数据库表：</p><p><img src="//liushuaiyang.oss-cn-shanghai.aliyuncs.com/nest-docs/image/176-2.png" alt="" loading="lazy"></p><p>需要这些表。</p><p>用户表存储用户信息，好友关系表就是存储用户和用户的关联关系。</p><p>好友申请表存储用户对用户的好友申请的记录。</p><p>聊天室表存储聊天室的信息。</p><p>用户所在聊天室表存储用户和聊天室的关联。</p><p>聊天记录表存储持久化的聊天记录。</p><p>收藏表存储用户收藏的聊天记录。</p><p>详细设计如下：</p><p>用户表 users：</p><table tabindex="0"><thead><tr><th>字段名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>INT</td><td>用户ID</td></tr><tr><td>username</td><td>VARCHAR(50)</td><td>用户名</td></tr><tr><td>password</td><td>VARCHAR(50)</td><td>密码</td></tr><tr><td>nick_name</td><td>VARCHAR(50)</td><td>昵称</td></tr><tr><td>email</td><td>VARCHAR(50)</td><td>邮箱</td></tr><tr><td>head_pic</td><td>VARCHAR(100)</td><td>头像</td></tr><tr><td>create_time</td><td>DATETIME</td><td>创建时间</td></tr><tr><td>update_time</td><td>DATETIME</td><td>更新时间</td></tr></tbody></table><p>好友关系表 friendship：</p><table tabindex="0"><thead><tr><th>字段名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>user1_id</td><td>INT</td><td>用户1</td></tr><tr><td>user2_id</td><td>INT</td><td>用户2</td></tr></tbody></table><p>聊天室表 chatroom：</p><table tabindex="0"><thead><tr><th>字段名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>INT</td><td>聊天室ID</td></tr><tr><td>name</td><td>VARCHAR(50)</td><td>群聊名</td></tr><tr><td>type</td><td>BOOLEAN</td><td>类型（单聊、群聊）</td></tr><tr><td>create_time</td><td>DATETIME</td><td>创建时间</td></tr><tr><td>update_time</td><td>DATETIME</td><td>更新时间</td></tr></tbody></table><p>用户所在聊天室表 user_chatroom：</p><table tabindex="0"><thead><tr><th>字段名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>user_id</td><td>INT</td><td>用户ID</td></tr><tr><td>chatroom_id</td><td>INT</td><td>聊天室ID</td></tr></tbody></table><p>聊天记录表 chat_history：</p><table tabindex="0"><thead><tr><th>字段名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>INT</td><td>聊天记录ID</td></tr><tr><td>content</td><td>VARCHAR(500)</td><td>聊天内容</td></tr><tr><td>chatroom_id</td><td>INT</td><td>聊天室ID</td></tr><tr><td>sender_id</td><td>INT</td><td>发送者ID</td></tr><tr><td>send_time</td><td>DATETIME</td><td>发送时间</td></tr><tr><td>update_time</td><td>DATETIME</td><td>更新时间</td></tr></tbody></table><p>好友申请表 friend_request：</p><table tabindex="0"><thead><tr><th>字段名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>INT</td><td>好友申请id</td></tr><tr><td>from_user_id</td><td>INT</td><td>发送方</td></tr><tr><td>to_user_id</td><td>INT</td><td>待添加好友</td></tr><tr><td>reason</td><td>VARCHAR(100)</td><td>添加理由</td></tr><tr><td>status</td><td>VARCHAR(10)</td><td>状态（待处理、已同意、已拒绝）</td></tr><tr><td>create_time</td><td>DATETIME</td><td>创建时间</td></tr><tr><td>update_time</td><td>DATETIME</td><td>更新时间</td></tr></tbody></table><p>收藏表 favorite：</p><table tabindex="0"><thead><tr><th>字段名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>INT</td><td>ID</td></tr><tr><td>user_id</td><td>INT</td><td>用户 ID</td></tr><tr><td>chat_history_id</td><td>INT</td><td>聊天记录ID</td></tr><tr><td>create_time</td><td>DATETIME</td><td>创建时间</td></tr><tr><td>update_time</td><td>DATETIME</td><td>更新时间</td></tr></tbody></table><p>然后划分下模块：</p><h2 id="模块划分" tabindex="-1">模块划分 <a class="header-anchor" href="#模块划分" aria-label="Permalink to &quot;模块划分&quot;">​</a></h2><p>首先是用户模块，实现登录、注册、信息修改的功能：</p><table tabindex="0"><thead><tr><th>接口路径</th><th>请求方式</th><th>描述</th></tr></thead><tbody><tr><td>/user/login</td><td>POST</td><td>用户登录</td></tr><tr><td>/user/register</td><td>POST</td><td>用户注册</td></tr><tr><td>/user/update</td><td>POST</td><td>用户个人信息修改</td></tr><tr><td>/user/update_password</td><td>POST</td><td>用户修改密码</td></tr></tbody></table><p>好友管理模块：</p><table tabindex="0"><thead><tr><th>接口路径</th><th>请求方式</th><th>描述</th></tr></thead><tbody><tr><td>/friendship/add</td><td>POST</td><td>添加好友</td></tr><tr><td>/friendship/delete</td><td>DELETE</td><td>删除好友</td></tr><tr><td>/friendship/list</td><td>GET</td><td>好友列表</td></tr></tbody></table><p>聊天室管理模块：</p><table tabindex="0"><thead><tr><th>接口路径</th><th>请求方式</th><th>描述</th></tr></thead><tbody><tr><td>/chatroom/join</td><td>GET</td><td>加入聊天室</td></tr><tr><td>/chatroom/exit</td><td>GET</td><td>退出聊天室</td></tr><tr><td>/chatroom/list</td><td>GET</td><td>聊天室列表</td></tr><tr><td>/chatroom/add</td><td>POST</td><td>新建聊天室（单聊、群聊）</td></tr></tbody></table><p>聊天模块：</p><table tabindex="0"><thead><tr><th>接口路径</th><th>请求方式</th><th>描述</th></tr></thead><tbody><tr><td>/chat</td><td>WEBSOCKET</td><td>聊天</td></tr></tbody></table><p>收藏管理模块：</p><table tabindex="0"><thead><tr><th>接口路径</th><th>请求方式</th><th>描述</th></tr></thead><tbody><tr><td>/favorite/add</td><td>GET</td><td>添加收藏</td></tr><tr><td>/favorite/delete</td><td>DELETE</td><td>删除收藏</td></tr><tr><td>/favorite/list</td><td>GET</td><td>收藏列表</td></tr></tbody></table><p>好友请求管理模块：</p><table tabindex="0"><thead><tr><th>接口路径</th><th>请求方式</th><th>描述</th></tr></thead><tbody><tr><td>/friend_request/list</td><td>GET</td><td>好友请求列表</td></tr><tr><td>/friend_request/agree</td><td>GET</td><td>同意好友请求</td></tr><tr><td>/friend_request/reject</td><td>GET</td><td>拒绝好友请求</td></tr></tbody></table><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>这节我们设计了下技术方案。</p><p>技术栈：前端是 antd + react + vite，后端是 nest + prisma + socket.io，数据库是 mysql + redis，对象存储用 minio，API 文档用 swagger 生成，部署用 docker compose + pm2，网关使用 nginx。</p><p>数据库表有 7 个：用户表 users、好友关系表 friendship、聊天室表 chatroom、用户所在聊天室表 user_chatroom、聊天记录表 chat_history、好友申请表 friend_request、收藏表 favorite。</p><p>模块有 6 个：用户模块、好友管理模块、聊天室管理模块、聊天模块、收藏管理模块、好友请求管理模块。</p><p>下节正式开始开发。</p>',54)]))}const c=d(h,[["render",i]]);export{l as __pageData,c as default};
